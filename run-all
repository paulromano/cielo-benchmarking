#!/bin/bash

set -e

target=0.13
options="--capture-03 --fission-03 --capture-78 --fission-78 --negative --nubar --pfns"

# Create new directory for run
if [[ $# -ge 1 ]]; then
    directory=$!
else
    directory=$(date +"%Y-%m-%d-%H%M%S")
fi
mkdir -p $directory

# 1) Make modifications to Pu-239 cross sections
python modify.py endf-b-vii-1.endf ${directory}/modified.endf \
    $target $options | tee ${directory}/modified.out

# 2) Run NJOY
./run-njoy modified.endf ${directory} | tee ${directory}/run-njoy.out

# 3) Modify cross sections for OpenMC use
./modify-csxml ${directory}

# 4) Run benchmarks
./run-benchmarks ${directory}
